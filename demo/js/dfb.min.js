"use strict";var view=function(){var t={},e={updating:false},i,n,o,r,a,d,c,s,l,u,f,p,w;i=function(t){if(t!==undefined){e.dfb=t}return e.dfb};t.dfb=i;n=function(t){if(typeof t==="boolean"){e.updating=t}return e.updating};t.updating=n;o=function(t,i){if(!e.dirty){e.dirty=d3.set()}if(i===undefined){return e.dirty.has(t)}if(i){e.dirty.add(t)}else{e.dirty.remove(t)}return i};t.dirty=o;r=function(t){d3.select("#working_icon").classed("invisible",!t)};t.loading=r;a=function(t,e){d3.select("#working_icon").classed("invisible",!e);d3.selectAll(t+" .calc").classed("hidden",!e);d3.selectAll(t+" .calc-done").classed("hidden",e)};t.calculating=a;d=function(t){d3.select("div#error").classed("hidden",false).append("p").text(t);this.loading(false);VIS.error=true};t.error=d;c=function(t){d3.select("div#warning").classed("hidden",false).append("p").text(t)};t.warning=c;s=function(){var t=e.tooltip;if(t){return t}t={offset:VIS.tooltip.offset};t.div=d3.select("body").append("div").attr("id","tooltip").classed("bar_tooltip",true);t.container=d3.select("body").node();t.div.append("p");t.update_pos=function(){var t=d3.mouse(this.container);this.div.style({left:t[0]+this.offset.x+"px",top:t[1]+this.offset.y+"px",position:"absolute"})};t.text=function(t){this.div.select("p").text(t)};t.show=function(){this.div.classed("hidden",false)};t.hide=function(){this.div.classed("hidden",true)};e.tooltip=t;return t};t.tooltip=s;l=function(t,e){t.append("td").classed("weight",true).append("div").classed("proportion",true).style("margin-left",function(t){return d3.format(".1%")(1-e(t))}).append("span").classed("proportion",true).html("&nbsp;")};t.append_weight_tds=l;u=function(t,e){var i;if(!VIS.svg){VIS.svg=d3.map()}if(VIS.svg.has(t)){i=VIS.svg.get(t);d3.select(t+" svg").attr("width",e.w+e.m.left+e.m.right).attr("height",e.h+e.m.top+e.m.bottom);i.attr("transform","translate("+e.m.left+","+e.m.top+")")}else{i=f(d3.select(t),e);VIS.svg.set(t,i)}return i};t.plot_svg=u;f=function(t,e){return t.append("svg").attr("width",e.w+e.m.left+e.m.right).attr("height",e.h+e.m.top+e.m.bottom).append("g").attr("transform","translate("+e.m.left+","+e.m.top+")")};t.append_svg=f;p=function(){window.scrollTo(window.scrollX,0)};t.scroll_top=p;w=function(){window.scrollTo(0,0)};t.scroll_origin=w;return t}();"use strict";var metadata=function(t){var e=t||{},i={},n,o,r,a,d,c;e.conditionals=d3.map(e.conditionals);n=function(t){if(typeof t!=="string"){return}e.docs=d3.csv.parse(t);if(e.date_field&&e.docs[0].hasOwnProperty(e.date_field)){e.docs.forEach(function(t){t[e.date_field]=new Date(t[e.date_field])})}};i.from_string=n;o=function(t){if(typeof t==="string"){e.date_field=t;return this}return e.date_field};i.date_field=o;r=function(t){if(isFinite(t)){return e.docs[t]}if(t===undefined){return e.docs}return t.map(function(t){return e.docs[t]})};i.doc=r;a=function(){if(e.docs){return e.docs.length}};i.n_docs=a;c=function(){return e.conditionals};i.conditionals=c;d=function(t,i,n){if(i===undefined){return e.conditionals.get(t)}e.conditionals.set(t,i(n,e.docs));return this};i.condition=d;return i};metadata.key={ordinal:function(t,e){var i=function(e){return e[t.field].replace(/\s/g,"_")};i.invert=function(t){return t.replace(/_/g," ")};i.display=i.invert;i.range=d3.set(e.map(i)).values();i.range.sort();return i},continuous:function(t,e){var i=d3.extent(e,function(e){return+e[t.field]}),n,o,r,a;i[0]=Math.floor(i[0]/t.step)*t.step;n=Math.floor(Math.log10(t.step));o=Math.ceil(Math.log10(d3.max(i,Math.abs)));if(o>=1){if(n<=0){r=d3.format("0"+String(o+Math.abs(n)+1)+"."+String(Math.abs(n))+"f")}else{r=d3.format("0"+String(o)+".0f")}}else{r=d3.format("."+String(Math.abs(n))+"f")}a=function(e){var n=i[0]+Math.floor((+e[t.field]-i[0])/t.step)*t.step;return r(n)};a.invert=function(t){return+t};a.display=function(e){return String(+e)+"–"+String(+e+t.step)};a.range=d3.range(Math.floor((i[1]-i[0])/t.step)).map(function(e){return r(i[0]+e*t.step)});return a},time:function(t,e){var i=d3.extent(e,function(e){return e[t.field]}),n,o,r,a,d,c,s,l=t.n||1,u=d3.time[t.unit].utc;n=[i[0]];o=u.offset(i[0],l);while(o<i[1]){n.push(o);o=u.offset(o,l)}r=function(t){return n[d3.bisect(n,t)-1]};switch(t.unit){case"year":c="%Y";break;case"month":c="%Y-%m";break;case"day":c="%Y-%m-%d";break;case"hour":c="%Y-%m-%d %H:00";break;case"minute":c="%Y-%m-%d %H:%M";break;case"second":c="%Y-%m-%d %H:%M:%S";break;default:r=function(t){return new Date(+i[0]+Math.floor((+t-+i[0])/l)*l)};c="%Y-%m-%dT%H:%M:%S.%LZ";break}a=d3.time.format.utc(c);if(l===1){d=function(e){return a(e[t.field])}}else{d=function(e){return a(r(e[t.field]))}}d.invert=function(t){return a.parse(t)};if(t.format){s=function(e){return d3.time.format.utc(t.format)(a.parse(e))}}else{s=function(t){return t}}if(l===1){d.display=function(t){return s(t)}}else{d.display=function(t){return s(t)+"–"+s(a(u.offset(a.parse(t),l)))}}d.range=n.map(r).map(a);return d}};"use strict";var bib=function(t){var e=t||{},i={},n,o,r,a;if(!e.sorting){e.sorting=[["all_raw","by raw entry"]]}n=function(t){if(t!==undefined){e.sorting=t}return e.sorting};i.sorting=n;i.keys={};i.keys.all=function(){return"All"};i.keys.raw=function(t){return JSON.stringify(t)};o=function(t){var e=[],n,o=t.dir.major?d3.ascending:d3.descending,r=t.dir.minor?d3.ascending:d3.descending,a=function(t){return t.id},d,c,s,l=[];n=t.docs.map(function(e,n){return{id:n,major:i.keys[t.major](e),minor:i.keys[t.minor](e)}}).sort(function(t,e){return o(t.major,e.major)||r(t.minor,e.minor)||d3.ascending(t.id,e.id)});for(c=0,d="";c<n.length;c+=1){if(n[c].major!==d){l.push(c);e.push({heading:n[c].major});d=n[c].major}}l.shift();l.push(n.length);for(c=0,s=0;c<l.length;c+=1){e[c].docs=n.slice(s,l[c]).map(a);s=l[c]}if(typeof i.keys[t.major].display_heading==="function"){e.forEach(function(e){e.heading_display=i.keys[t.major].display_heading(e.heading)})}return e};i.sort=o;o.validate=function(t){var i=e.sorting.map(function(t){return t[0].split("_")[0]}),n=e.sorting.map(function(t){return t[0].split("_")[1]}),o=t;if(i.indexOf(t.major)===-1){o.major=undefined}if(n.indexOf(t.minor)===-1){o.minor=undefined}if(t.dir!=="up"&&t.dir!=="down"){o.dir=undefined}return o};o.dir=function(t){return{major:t.dir!=="down",minor:true}};r=function(t){return JSON.stringify(t)};i.citation=r;a=function(){return""};i.url=a;return i};"use strict";var VIS={ready:{},last:{bib:{}},files:{info:"data/info.json",meta:"data/meta.csv.zip",dt:"data/dt.json.zip",tw:"data/tw.json",pl:"data/pl.json",dpl:"data/doc_pl.json",topic_scaled:"data/topic_scaled.csv"},aliases:{yearly:"conditional"},default_view:"/model",metadata:{type:"dfr",spec:{extra_fields:[],date_field:"date"}},condition:{type:"time",spec:{field:"date",unit:"year",n:1}},overview_words:15,model_view:{plot:{w:500,aspect:1.3333,words:6,size_range:[7,18],name_size:18,stroke_range:6},conditional:{w:500,aspect:1.333,m:{left:20,right:20,top:20,bottom:30},label_threshold:40,words:4,label_words:2,streamgraph:true,ordinal:{bar:.4}},list:{spark:{w:70,h:20,m:{left:2,right:2,top:2,bottom:2},time:{bar:{unit:"day",w:300}},ordinal:{bar:{w:.25}},continuous:{bar:{w:.25}}}}},topic_view:{words:50,docs:20,w:400,aspect:3,m:{left:40,right:20,top:20,bottom:30},time:{bar:{unit:"day",w:90},ticks:10},continuous:{bar:{w:.25},ticks:10},ordinal:{bar:{w:.25},ticks:10},ticks_y:10,tx_duration:1e3},word_view:{n_min:10,topic_label_padding:8,topic_label_leading:14,row_height:80,svg_rows:10,w:700,m:{left:100,right:40,top:20,bottom:0}},bib:{author_delimiter:"\t",et_al:Infinity,anon:"[Anon]"},bib_view:{window_lines:100,major:"year",minor:"authortitle",dir:"up"},tooltip:{offset:{x:10,y:0}},percent_format:d3.format(".1%"),resize_refresh_delay:100,hidden_topics:[],show_hidden_topics:false,annotes:[],update:function(t){return utils.deep_replace(this,t)}};"use strict";var model;model=function(t){var e=t||{},i={},n,o,r,a,d,c,s,l,u,f,p,w,m,_,v,h,g,y,b,x,S,I,k,V,A,z,j,M,E,N,$;e.ready={};e.worker=new Worker("js/worker.min.js");e.worker.fs=d3.map();e.worker.onmessage=function(t){var i=e.worker.fs.get(t.data.what);if(i){i(t.data.result)}};e.worker.callback=function(t,i){e.worker.fs.set(t,i)};n=function(t){if(t){e.info=t}return e.info};i.info=n;o=function(){var t;if(e.n_docs!==undefined){t=e.n_docs}else if(e.meta){t=e.meta.n_docs()}return t};i.n_docs=o;r=function(){return!!e.ready.dt};i.has_dt=r;a=function(t,i){if(!e.tw){return undefined}if(t===undefined){return e.tw}if(i===undefined){return e.tw[t]}return e.tw[t].get(i)};i.tw=a;d=function(t,i){if(!e.pl){return undefined}if(t===undefined){return e.pl}if(i===undefined){return e.pl[t]}return e.pl[t].get(i)};i.pl=d;s=function(t,i){if(!e.dpl){return undefined}if(i===undefined&&t!==undefined){return e.dpl[t-1].get(t)}return e.dpl};i.dpl=s;l=function(){return e.n};i.n=l;u=function(){if(!this.tw()){return undefined}return e.tw[0].keys().length};i.n_top_words=u;f=function(t){if(!e.total_tokens){e.worker.callback("total_tokens",function(i){e.total_tokens=i;t(i)});e.worker.postMessage({what:"total_tokens"})}else{t(e.total_tokens)}};i.total_tokens=f;p=function(t,i){var n=isFinite(t)?t:"all";e.worker.callback("topic_total/"+n,i);e.worker.postMessage({what:"topic_total",t:n})};i.topic_total=p;w=function(t){if(!e.alpha){return undefined}return isFinite(t)?e.alpha[t]:e.alpha};i.alpha=w;m=function(t){if(!e.meta){return undefined}return e.meta.doc(t)};i.meta=m;_=function(t){return e.meta.condition(t)};i.meta_condition=_;v=function(t){var e=d3.set(),n;if(!a()){return undefined}if(isFinite(t)){a(t).keys().forEach(e.add)}else{if(t===undefined){n=a()}else{n=t.map(function(t){return i.tw(t)})}n.forEach(function(t){t.keys().forEach(function(t){e.add(t)})})}return e.values().sort()};i.vocab=v;h=function(t){if(!e.topic_scaled){return undefined}if(t===undefined){return e.topic_scaled}return e.topic_scaled[t]};i.topic_scaled=h;y=function(t,i,n){var o=i===undefined?"all":i,r=o!=="all"?n:function(t){n(d3.map(t))};e.worker.callback("conditional_total/"+t+"/"+o,r);e.worker.postMessage({what:"conditional_total",v:t,key:o})};i.conditional_total=y;g=function(t,i,n){var o=t===undefined?"all":t,r;if(o==="all"){r=function(t){n(t.map(d3.map))}}else{r=function(t){n(d3.map(t))}}e.worker.callback("topic_conditional/"+i+"/"+o,r);e.worker.postMessage({what:"topic_conditional",t:o,v:i})};i.topic_conditional=g;c=function(t,i,n){e.worker.callback("docs_polarity/"+t+"/"+i,n);e.worker.postMessage({what:"docs_polarity",topics:t,n:i})};i.docs_polarity=c;b=function(t,i,n){e.worker.callback("topic_docs/"+t+"/"+i,n);e.worker.postMessage({what:"topic_docs",t:t,n:i})};i.topic_docs=b;x=function(t,i,n,o,r){e.worker.callback(["topic_docs_conditional",t,i,n,o].join("/"),r);e.worker.postMessage({what:"topic_docs_conditional",t:t,v:i,key:n,n:o})};i.topic_docs_conditional=x;I=function(t,i,n){e.worker.callback("doc_topics/"+t+"/"+i,n);e.worker.postMessage({what:"doc_topics",d:t,n:i})};i.doc_topics=I;S=function(t,e){var n=e||this.n_top_words(),o;if(t===undefined){return d3.range(this.n()).map(function(t){return i.topic_words(t,e)})}o=this.tw(t).entries();o.sort(function(t,e){return d3.descending(t.value,e.value)||d3.ascending(t.key,e.key)});return utils.shorten(o,n,function(t,e){return t[e].value}).map(function(t){return{word:t.key,weight:t.value}})};i.topic_words=S;k=function(t,e){var i,n,o,r=e||this.n_top_words(),a=[],d=function(t){return t.values().reduce(function(t,e){return e>o?t+1:t},0)};for(i=0;i<this.n();i+=1){n=this.tw(i);if(n.has(t)){o=n.get(t);a.push({topic:i,rank:d(n)})}}a.sort(function(t,e){return d3.ascending(t.rank,e.rank)||d3.ascending(t.topic,e.topic)});return utils.shorten(a,r,function(t,e){return t[e].rank})};i.word_topics=k;V=function(t){var i=String(t+1);if(e.info.topic_labels&&e.info.topic_labels[i]){return e.info.topic_labels[i]}return"Topic"+" "+i};i.topic_label=V;z=function(t){var i;if(typeof t!=="string"){return}i=JSON.parse(t);e.alpha=i.alpha;e.tw=i.tw.map(function(t){var e=d3.map();t.words.map(function(i,n){e.set(i,t.weights[n])});return e});if(!e.n){e.n=e.alpha.length}};i.set_tw=z;j=function(t){var i;if(typeof t!=="string"){return}i=JSON.parse(t);e.pl=i.pl.map(function(t){var e=d3.map();e=t.words.map(function(e,i){return{word:e,polarity:t.polarity[i]}});return e});if(!e.n){e.n=e.pl.length}};i.set_pl=j;A=function(t,i){if(typeof t!=="string"){i(false)}e.worker.callback("set_dt",function(t){e.ready.dt=t;i(t)});e.worker.postMessage({what:"set_dt",dt:JSON.parse(t)})};i.set_dt=A;M=function(t,i){var n;if(typeof t!=="string"){return}n=JSON.parse(t);e.dpl=n.doc_pl.map(function(t){var e=d3.map();e.set(t.doc,t.polarity);return e})};i.set_dpl=M;E=function(t){e.meta=t;t.conditionals().forEach(N)};i.set_meta=E;N=function(t,i){var n;n=e.meta.doc().map(i);e.worker.callback("set_doc_categories/"+t,function(i){if(!e.ready.doc_categories){e.ready.doc_categories={}}e.ready.doc_categories[t]=i});e.worker.postMessage({what:"set_doc_categories",v:t,keys:n})};i.doc_category=N;$=function(t){var i;if(typeof t!=="string"){return}i=t.replace(/^\n*/,"").replace(/\n*$/,"\n");e.topic_scaled=d3.csv.parseRows(i,function(t){return t.map(parseFloat)})};i.set_topic_scaled=$;return i};"use strict";bib.dfr=function(t){var e=t||{},i=bib(e),n;i.sorting([["year_authortitle","by year, then by author"],["issue_journalcontents","by journal issue"],["year_journalcontents","by year, then by journal contents"],["decade_date","chronologically by decades"],["decade_authortitle","by decades, then by author"],["author_authortitle","alphabetically by author"]]);i.keys.author=function(t){return n(t.authors).replace(/^\W*/,"")[0].toUpperCase()};i.keys.authortitle=function(t){var e=n(t.authors)+t.title;return e.toLowerCase()};i.keys.decade=function(t){return Math.floor(t.date.getUTCFullYear()/10).toString()+"0s"};i.keys.year=function(t){return t.date.getUTCFullYear()};i.keys.journal=function(t){return t.journal};i.keys.issue=function(t){var e=t.journal;e+="_"+d3.format("05d")(t.volume);if(t.issue){e+="_"+t.issue}return e};i.keys.issue.display_heading=function(t){var e,i;e=t.split("_");i=e[0]+" "+String(+e[1]);if(e.length>2){i+="."+e[2]}return i};i.keys.date=function(t){return+t.date};i.keys.journalcontents=function(t){var e=t.journal;e+=d3.format("05d")(t.volume);e+=d3.format("05d")(t.issue===""?0:t.issue.replace(/\/.*$/,""));if(t.pagerange.search(/^\d/)!==-1){e+=d3.format("05d")(t.pagerange.match(/^(\d+)/)[1])}else{e+=t.pagerange}return e};i.sort.dir=function(t){var e={major:true,minor:true};if(t.dir==="up"){return e}if(t.dir==="down"){e.major=false;if(t.major==="decade"||t.major==="year"||t.major==="issue"){e.minor=t.minor!=="date"&&t.minor!=="journal"}else if(t.major==="alpha"||t.major==="journal"){e.minor=t.minor!=="alpha"}else{e.minor=true}}return e};n=function(t){var i,n,o,r=t.split(e.author_delimiter).filter(function(t){return/\S/.test(t)}),a=r.length;if(a===0){return e.anon}i=r[0].replace(/,/g,"").split(" ");n=i.pop();if(i.length>=2&&n.search(/^(\d|Jr|Sr|[IXV]+$)/)!==-1){o=i.pop().replace(/_$/,"");n=", "+n.replace(/\W*$/,"")}else{o=n;n=""}o+=", "+i.join(" ")+n;if(a>1){if(a>=e.et_al){o+=", ";o+=r.slice(1,e.et_al).join(", ");o+="et al."}else{if(a>2){o+=", "}o+=r.slice(1,a-1).join(", ");o+=", and "+r[a-1]}}return o};i.doc_author=n;i.citation=function(t){var e;e=t.title.replace(/“/g,"‘").replace(/”/g,"’").replace(/(^|[-\u2014\/(\[{\u2018\s])"/g,"$1‘").replace(/"/g,"’").replace(/'/g,"’").replace(/ <br><\/br>/g,". ");var i="“"+e+" .”";i=i.replace(/’\./g,".’");var n=" ("+d3.time.format.utc("%B %Y")(t.date)+"): ";i+=n;return i};i.url=function(t){return t.doi};return i};"use strict";metadata.dfr=function(t){var e=t||{},i,n;i=metadata(e);if(!Array.isArray(e.extra_fields)){e.extra_fields=[]}n=function(t){var i;if(typeof t!=="string"){return}i=t.replace(/^\n*/,"").replace(/\n*$/,"\n");e.docs=d3.csv.parseRows(i,function(t,e){var i;i={date:new Date(t[0].trim()),title:t[1].trim(),category:t[2].trim(),doi:t[3].trim()};return i})};i.from_string=n;return i};"use strict";view.about=function(t){if(!VIS.ready.about){if(t.meta_info){d3.select("div#meta_info").html(t.meta_info)}VIS.ready.about=true}return true};"use strict";view.bib=function(t){var e=t.ordering.map(function(e){var i=e;e.key=e.heading+"_"+t.minor+"_"+t.dir;return i}),i;d3.selectAll("select#select_bib_sort option").each(function(){this.selected=this.value===t.major+"_"+t.minor});d3.selectAll("select#select_bib_dir option").each(function(){this.selected=this.value===t.dir});d3.select("select#select_bib_sort").on("change",function(){var t;d3.selectAll("#select_bib_sort option").each(function(){if(this.selected){t=this.value}});view.dfb().set_view("/bib/"+t.replace(/_/,"/"))});d3.select("select#select_bib_dir").on("change",function(){var e;d3.selectAll("#select_bib_dir option").each(function(){if(this.selected){e=this.value}});view.dfb().set_view("/bib/"+t.major+"/"+t.minor+"/"+e)});d3.select("a#bib_sort_dir").attr("href","#/bib/"+t.major+"/"+t.minor+"/"+(t.dir==="up"?"down":"up"));d3.select("#bib_headings a.top_link").on("click",function(){d3.event.preventDefault();view.scroll_top()});i=d3.select("#bib_view #bib_headings ul").selectAll("li").data(e,function(t){return t.key});i.enter().append("li").append("a");i.exit().remove();view.bib.major_keys.forEach(function(e){i.classed(e,t.major===e)});i.selectAll("a").attr("href",function(t){return"#"+view.bib.id(t.heading)}).on("click",function(t){d3.event.preventDefault();d3.select("#"+view.bib.id(t.heading)).node().scrollIntoView()}).text(function(t){return t.heading_display||t.heading});view.bib.render({ordering:e,citations:t.citations,major:t.major});return true};view.bib.render=function(t){var e,i,n;view.loading(true);e=d3.select("#bib_main").selectAll("div.section").data(t.ordering,function(t){return t.key});i=e.enter().append("div").classed("section",true).attr("id",function(t){return view.bib.id(t.heading)});i.append("h2").text(function(t){return t.heading_display||t.heading});i.append("ul");e.exit().remove();n=e.select("ul").selectAll("li").data(function(t){return t.docs});n.enter().append("li");n.exit().remove();n.html(function(e){var i='<a href="#/doc/'+e+'">';i+=t.citations[e];i+="</a>";return i});view.loading("false")};view.bib.id=function(t){return"bib_"+String(t).replace(/\W/g,"_")};view.bib.dropdown=function(t){var e=d3.select("select#select_bib_sort").selectAll("option").data(t);e.enter().append("option");e.exit().remove();e.attr("id",function(t){return"sort_"+t[0]}).property("value",function(t){return t[0]}).text(function(t){return t[1]});view.bib.major_keys=d3.set(t.map(function(t){return t[0].split("_")[0]}))};"use strict";view.doc=function(t){var e=d3.select("div#doc_view"),i=t.total_tokens,n=t.topics,o,r;d3.select("#doc_view_main").classed("hidden",false);e.select("h2#doc_header").html(t.citation);e.select("#doc_remark .token_count").text(t.total_tokens);e.select("#doc_remark a.url").attr("href",t.url);o=e.select("table#doc_topics tbody").selectAll("tr").data(n);o.enter().append("tr");o.exit().remove();o.selectAll("td").remove();r=o.append("td").append("a").attr("href",function(t){return view.topic.link(t.topic)}).classed("topic_words",true);r.append("span").classed("name",true).text(function(e,i){return t.labels[i]});o.append("td").append("a").attr("href",function(t){return view.topic.link(t.topic)}).append("span").classed("words",true).text(function(e,i){return t.words[i].reduce(function(t,e){return t+" "+e.word},"")});o.on("click",function(t){view.dfb().set_view(view.topic.hash(t.topic))});view.append_weight_tds(o,function(t){return t.weight/i});o.append("td").classed("td-right",true).text(function(t){return VIS.percent_format(t.weight/i)});o.append("td").classed("td-right",true).text(function(t){return t.weight})};"use strict";view.model=function(){return true};"use strict";view.model.conditional=function(t){var e=t.type?t.type==="raw":VIS.last.model_conditional;VIS.last.model_conditional=e;if(view.dirty("model/conditional")){this.conditional.data=view.model.stacked_series({keys:t.key.range,xs:t.key.range.map(t.key.invert),totals:t.conditional_totals,topics:t.topics,streamgraph:t.streamgraph&&t.condition_type!=="ordinal"});view.dirty("model/conditional",false)}view.model.conditional_plot({condition_type:t.condition_type,condition_name:t.condition_name,data:this.conditional.data[e?"raw":"frac"],domain_x:this.conditional.data.domain_x,domain_y:this.conditional.data[e?"domain_raw":"domain_frac"],order:this.conditional.data.order,spec:VIS.model_view.conditional,raw:e,selector:"#model_view_conditional"});d3.selectAll("#conditional_choice li").classed("active",false);d3.select(e?"#nav_model_conditional_raw":"#nav_model_conditional_frac").classed("active",true)};view.model.conditional_plot=function(t){var e=t.spec,i,n,o,r,a,d,c,s,l,u,f,p,w,m,_,v;e.w=d3.select(t.selector).node().clientWidth||e.w;e.w-=e.m.left+e.m.right;e.h=Math.floor(e.w/e.aspect);e.h-=e.m.top+e.m.bottom;i=view.plot_svg(t.selector,e);l=i.selectAll("rect.bg").data([1]).enter().append("rect").classed("bg",true);l.attr("width",e.w).attr("height",e.h).classed("bg",true);u=d3.select("#model_conditional_clip");if(u.size()===0){u=d3.select("#model_view_conditional svg").append("clipPath").attr("id","model_conditional_clip");u.append("rect").attr("x",0).attr("y",0).attr("width",e.w).attr("height",e.h)}d3.select("#model_conditional_clip rect").transition().duration(2e3).attr("width",e.w).attr("height",e.h);s=function(){var e=d3.scale.category20(),i=[];t.order.forEach(function(t,e){i[t]=e});return function(t,n){var o=e(i[t]%20);return n?d3.hsl(o).brighter(.5).toString():o}}();if(t.condition_type==="ordinal"){n=d3.scale.ordinal().domain(t.domain_x).rangeRoundBands([0,e.w],e.ordinal.bar);f="g"}else{n=t.condition_type==="time"?d3.time.scale.utc():d3.scale.linear();n.domain(t.domain_x).range([0,e.w]);f="path"}o=d3.scale.linear().domain(t.domain_y).range([e.h,0]).nice();r=d3.svg.axis().scale(n).orient("bottom");d=i.selectAll("g.axis").data([1]);d.enter().append("g").classed("axis",true).classed("x",true).attr("transform","translate(0,"+e.h+")");d.transition().duration(2e3).attr("transform","translate(0,"+e.h+")").call(r);if(t.condition_type!=="time"){a=i.selectAll("text.axis_label").data([1]);a.enter().append("text");a.classed("axis_label",true).attr("x",e.w/2).attr("y",e.h+e.m.bottom).attr("text-anchor","middle").text(t.condition_name)}p=i.selectAll(f+".topic_area").data(t.data,function(t){return t.t});p.enter().append(f).classed("topic_area",true).attr("clip-path","url(#model_conditional_clip)").style("fill",function(t){return s(t.t)}).on("mouseover",function(e){var i=e.label;d3.select(this).style("fill",s(e.t,true));if(t.spec.words>0){i+=": ";i+=e.words.join(" ")}view.tooltip().text(i);view.tooltip().update_pos();view.tooltip().show()}).on("mousemove",function(t){view.tooltip().update_pos()}).on("mouseout",function(t){d3.select(this).style("fill",s(t.t));view.tooltip().hide()}).on("click",function(t){if(!d3.event.shiftKey){view.dfb().set_view(view.topic.hash(t.t))}});p.exit().remove();if(f==="path"){c=d3.svg.area().x(function(t){return n(t.x)}).y0(function(t){return o(t.y0)}).y1(function(t){return o(t.y0+t.y)});w=function(t){return function(e){var i=t?e.transition().duration(2e3):e;i.attr("d",function(t){return c(t.values)})}}}else{w=function(t){return function(e){var i=e.selectAll("rect").data(function(t){return t.values});i.enter().append("rect");i.exit().remove();if(t){i=i.transition().duration(2e3)}i.attr("x",function(t){return n(t.x)}).attr("y",function(t){return o(t.y0+t.y)}).attr("width",n.rangeBand()).attr("height",function(t){return o(t.y0)-o(t.y0+t.y)})}}}p.call(w(true));m=i.selectAll("text.layer_label").data(t.data,function(t){return t.t});m.enter().append("text").classed("layer_label",true).attr("clip-path","url(#model_conditional_clip)");m.exit().remove();_=function(i){var r,a,d,c,s,l=[],u=[],f=n.domain()[0],p=n.domain()[1],w=o.domain()[0],m=o.domain()[1],_=o(0);for(r=0;r<t.data.length;r+=1){d=t.data[r].t;l[d]=false;c=t.data[r].values;for(a=0,s=0;a<c.length;a+=1){if(c[a].x>=f&&c[a].x<=p&&c[a].y0+c[a].y>=w&&c[a].y0+c[a].y<=m){if(c[a].y>s&&_-o(c[a].y)>e.label_threshold){l[d]=true;u[d]=a;s=c[a].y}}}}i.attr("display",function(t){return l[t.t]?"inherit":"none"});i.filter(function(t){return l[t.t]}).attr("x",function(t){return n(t.values[u[t.t]].x)}).attr("y",function(t){return o(t.values[u[t.t]].y0+t.values[u[t.t]].y/2)}).text(function(t){var i=t.label;if(e.label_words>0){i+=": ";i+=t.words.slice(0,e.label_words).join(" ")}return i})};m.transition().duration(2e3).call(_);v=d3.behavior.zoom();if(t.condition_type!=="ordinal"){v.x(n)}v.y(o).scaleExtent([1,5]).on("zoom",function(){p.call(w(VIS.zoom_transition));if(VIS.zoom_transition){i.select("g.x.axis").transition().duration(2e3).call(r);m.transition().duration(2e3).call(_);VIS.zoom_transition=false}else{m.call(_);i.select("g.x.axis").call(r)}});d3.select("button#reset_zoom").on("click",function(){VIS.zoom_transition=true;v.translate([0,0]).scale(1).event(i)});v(i);return true};view.model.stacked_series=function(t){var e,i,n,o={};e=t.topics.map(function(e){var i={t:e.t,words:e.words.map(function(t){return t.word}),label:e.label};i.values=t.keys.map(function(i,n){return{key:i,x:t.xs[n],y:e.wts.get(i)||0}});return i});i=d3.layout.stack().values(function(t){return t.values});if(t.streamgraph){i.offset("wiggle")}i.order("inside-out");o.frac=i(e);o.order=i.order()(e.map(function(t){return t.values.map(function(t){return[t.x,t.y]})}));i.order(function(t){return o.order});o.raw=i(e.map(function(e){return{t:e.t,words:e.words,label:e.label,values:e.values.map(function(e){return{x:e.x,y:e.y*(t.totals.get(e.key)||0)}})}}));n=function(t){return[0,d3.max(t.map(function(t){return d3.max(t.values,function(t){return t.y0+t.y})}))]};o.domain_x=d3.extent(t.xs);o.domain_frac=n(o.frac);o.domain_raw=n(o.raw);return o};"use strict";view.model.list=function(t){var e,i,n,o=d3.sum(t.sums),r,a,d,c,s;e=d3.select("#model_view_list table tbody").selectAll("tr");if(!VIS.ready.model_list){s=utils.clone(VIS.model_view.list.spark);s.time.step=VIS.condition.spec;d3.select("th#model_view_list_condition a").text(t.type==="time"?"over time":"by "+t.condition_name);e=e.data(d3.range(t.data.length)).enter().append("tr");e.on("click",function(t){view.dfb().set_view(view.topic.hash(t))});e.classed("hidden_topic",function(e){return t.topic_hidden[e]});e.append("td").append("a").classed("topic_name",true).attr("href",view.topic.link).text(function(e){return t.labels[e]});i=e.append("td").append("div").classed("spark",true);view.append_svg(i,s).each(function(e){view.topic.conditional_barplot({t:e,data:t.data[e],key:t.key,type:t.type,axes:false,clickable:false,svg:d3.select(this),spec:s})});e.append("td").append("a").classed("topic_words",true).attr("href",view.topic.link);n=d3.max(t.sums);view.append_weight_tds(e,function(e){return t.sums[e]/n});e.append("td").text(function(e){return VIS.percent_format(t.sums[e]/o)});VIS.ready.model_list=true}e.selectAll("td a.topic_words").text(function(e){return t.words[e].reduce(function(t,e){return t+" "+e.word},"")});if(!VIS.last.model_list){VIS.last.model_list={}}d=t.sort||VIS.last.model_list.sort||"topic";c=t.dir||(d===VIS.last.model_list.sort?VIS.last.model_list.dir:"up")||"up";if(d==="words"){r=t.words.map(function(t){return t.reduce(function(t,e){return t+" "+e.word},"")})}else if(d==="frac"){r=t.sums.map(function(t){return-t/o})}else if(d==="condition"){r=t.data.map(function(t){var e,i=0;t.forEach(function(t,n){if(n>i){e=t;i=n}});return e})}else{r=t.labels.map(view.topic.sort_name)}if(c==="down"){a=function(t,e){return d3.descending(r[t],r[e])||d3.descending(t,e)}}else{a=function(t,e){return d3.ascending(r[t],r[e])||d3.ascending(t,e)}}VIS.last.model_list.sort=d;VIS.last.model_list.dir=c;e.sort(a).order();d3.selectAll("#model_view_list th.sort").classed("active",function(){return!!this.id.match(d)}).each(function(){var t="#/"+this.id.replace(/_(view_)?/g,"/");if(this.id.match(d)){t+=c==="down"?"/up":"/down"}d3.select(this).select("a").attr("href",t)}).on("click",function(){view.dfb().set_view(d3.select(this).select("a").attr("href").replace(/#/,""))});return true};"use strict";view.model.plot=function(t){var e,i,n,o,r,a,d,c,s,l,u,f,p,w,m,_,v=t.topics,h=t.topics.length,g={};g.w=d3.select("#model_view").node().clientWidth||VIS.model_view.plot.w;g.w=Math.max(g.w,VIS.model_view.plot.w);g.h=Math.floor(g.w/VIS.model_view.plot.aspect);g.m={left:0,right:0,top:0,bottom:0};e=view.plot_svg("#model_view_plot",g);n=Math.floor(g.w/(2.1*Math.sqrt(VIS.model_view.plot.aspect*h)));i=n*1.8;o=1.1*n;r=e.selectAll("rect.bg").data([1]);r.enter().append("rect").classed("bg",true);r.attr("width",g.w);r.attr("height",g.h);if(t.type==="scaled"){v.forEach(function(t,e){v[e].x=t.scaled[0];v[e].y=t.scaled[1]})}else{v.forEach(function(t,e){v[e].sort_key=view.topic.sort_name(t.label)});v=v.sort(function(t,e){return d3.ascending(t.sort_key,e.sort_key)});view.model.grid_coords({n:h,cols:VIS.model_view.plot.cols||Math.floor(Math.sqrt(VIS.model_view.plot.aspect*h)),rows:VIS.model_view.plot.rows,indents:VIS.model_view.plot.indents}).forEach(function(t,e){v[e].x=t.x;v[e].y=t.y})}a=d3.extent(v,function(t){return t.x});d=d3.extent(v,function(t){return t.y});c=d3.scale.linear().domain(a).range([o,g.w-o]);s=d3.scale.linear().domain(d).range([g.h-o,o]);l=d3.scale.sqrt().domain([0,1]).range(VIS.model_view.plot.size_range);u=d3.scale.linear().domain([0,d3.max(v,function(t){return t.total})]).range([0,VIS.model_view.plot.stroke_range]);f=e.selectAll("g").data(v,function(t){return t.t});p=f.enter().append("g");f.exit().remove();p.append("clipPath").attr("id",function(t){return"clip_circ"+t.t}).append("circle").attr({cx:0,cy:0});p.append("circle").attr("cx",0).attr("cy",0).classed("topic_cloud",true).attr("stroke-width",function(t){return u(t.total)}).on("click",function(t){if(!d3.event.shiftKey){view.dfb().set_view(view.topic.hash(t.t))}}).on("mouseover",function(t){f.sort(function(e,i){if(e.t===i.t){return 0}if(e.t===t.t){return 1}if(i.t===t.t){return-1}return d3.ascending(e.t,i.t)}).order()}).on("mouseout",function(){f.sort(function(t,e){return d3.ascending(t.t,e.t)}).order()});w=f.selectAll("text.topic_word").data(function(t){var e=t.words[0].weight,n=t.words.map(function(i){return{text:i.word,size:Math.floor(l(i.weight/e)),t:t.t}}),o=0,r=0,a=false,d;for(d=0;d<n.length;d+=1,a=!a){if(a){n[d].y=o;o-=n[d].size}else{r+=n[d].size;n[d].y=r}if(o-i/2<n[d].size&&r>i/2){break}}return n.slice(0,d)});w.enter().append("text").classed("topic_word",true).attr("clip-path",function(t){return"url(#"+"clip_circ"+t.t}).style("font-size","1px");w.text(function(t){return t.text}).attr("x",0).attr("y",function(t){return t.y});p.selectAll("text.topic_name").data(function(t){var e=t.label.split(" ");return e.map(function(t,i){return{w:t,y:VIS.model_view.plot.name_size*(i-(e.length-1)/2)}})}).enter().append("text").classed("topic_name",true).attr("x",0).attr("y",function(t){return t.y}).text(function(t){return t.w}).style("font-size",VIS.model_view.plot.name_size+"px").classed("merged_topic_sep",function(t){return t.w==="or"});m=function(t){var e="translate("+c(t.x);e+=","+s(t.y)+")";return e};f.transition().duration(1e3).attr("transform",m).selectAll("circle").attr("r",n);p.transition().duration(0).attr("transform",m).selectAll("circle").attr("r",n);w.transition().duration(1e3).style("font-size",function(t){return t.size+"px"});p.selectAll("text.topic_word").transition().duration(0).style("font-size",function(t){return t.size+"px"});w.exit().transition().duration(1e3).style("font-size","1px").remove();if(t.type==="scaled"){_=d3.behavior.zoom().x(c).y(s).scaleExtent([1,10]).on("zoom",function(){if(VIS.zoom_transition){f.transition().duration(1e3).attr("transform",m);VIS.zoom_transition=false}else{f.attr("transform",m)}});d3.select("button#reset_zoom").on("click",function(){VIS.zoom_transition=true;_.translate([0,0]).scale(1).event(e)});_(e)}else{e.on(".zoom",null)}};view.model.grid_coords=function(t){
var e=t.cols||Math.floor(Math.sqrt(t.n)),i=Math.round(t.n/e),n=t.n-i*e,o=d3.ascending(n,0),r,a,d,c,s,l=[];d=Math.sqrt(3)/2;if(t.rows&&d3.sum(t.rows)===t.n){r=t.rows;i=t.rows.length}if(r===undefined){r=[];for(c=o===1?0:1;c<i;c+=2){r[c]=e;if(Math.abs(n)>0){r[c]+=o;n-=o}}for(c=o===1?1:0;c<i;c+=2){r[c]=e;if(Math.abs(n)>0){r[c]+=o;n-=o}}if(o===-1){r.reverse()}}if(t.indents&&t.indents.length===i){a=t.indents}if(a===undefined){a=d3.range(i).map(function(t){return t%2===0?0:.5})}for(c=0;c<i;c+=1){for(s=0;s<r[c];s+=1){l.push({x:s+.5+a[c],y:(i-c)*d+.5})}}return l};"use strict";view.settings=function(t){var e;if(VIS.ready.settings){return}e=d3.select("#settings_modal");e.select("#n_words_list input").property("min",1).property("max",t.max_words).property("value",VIS.overview_words).on("change",function(){VIS.overview_words=this.valueAsNumber});e.select("#n_words_topic input").property("min",1).property("max",t.max_words).property("value",VIS.topic_view.words).on("change",function(){VIS.topic_view.words=this.valueAsNumber;view.dirty("topic/words",true)});e.select("#n_topic_docs input").property("min",1).property("max",t.max_docs).property("value",VIS.topic_view.docs).on("change",function(){VIS.topic_view.docs=this.valueAsNumber;view.dirty("topic/docs",true)});e.select("#reveal_hidden").classed("hidden",VIS.hidden_topics.length===0).select("input").property("checked",VIS.show_hidden_topics===true).on("change",function(){VIS.show_hidden_topics=!VIS.show_hidden_topics;view.dirty("model/conditional",true)});e.select("#conditional_streamgraph").classed("hidden",VIS.condition.type==="ordinal").select("input").property("checked",!!VIS.model_view.conditional.streamgraph).on("change",function(){VIS.model_view.conditional.streamgraph=!VIS.model_view.conditional.streamgraph;view.dirty("model/conditional",true)});VIS.ready.settings=true};"use strict";view.topic=function(t){var e=d3.select("div#topic_view");e.select("#topic_header").text(t.label)};view.topic.remark=function(t){d3.select("#topic_view #topic_remark").text(VIS.percent_format(t.col_sum/t.total_tokens)+" of corpus")};view.topic.corr=function(t){var e,i,n,o,r,a,d,c,s,l,u,f,p,w,m,_,v=[],h=[],g,y,b,x=t.topics,S=t.topics.length,I=t.select,k={};k.w=d3.select("#topic_correlations").node().clientWidth||VIS.model_view.plot.w;k.w=Math.max(k.w,VIS.model_view.plot.w);k.h=Math.floor(k.w/VIS.model_view.plot.aspect);k.m={left:0,right:0,top:0,bottom:0};e=view.plot_svg("#topic_plot_corr",k);x.forEach(function(t){v.push(t.total);h.push(t.polarity)});g=d3.sum(v);n=Math.floor(k.w/(1*Math.sqrt(VIS.model_view.plot.aspect*S)));i=n*1.8;o=1.1*n;r=e.selectAll("rect.bg").data([1]);r.enter().append("rect").classed("bg",true);r.attr("width",k.w);r.attr("height",k.h);x.forEach(function(t,e){x[e].x=t.scaled[0];x[e].y=t.scaled[1]});a=d3.extent(x,function(t){return t.x});d=d3.extent(x,function(t){return t.y});c=d3.extent(x,function(t){return t.polarity});p=d3.scale.linear().domain(c).range([0,1]);s=d3.scale.linear().domain(a).range([o,k.w-o]);l=d3.scale.linear().domain(d).range([k.h-o,o]);u=d3.scale.sqrt().domain([0,1]).range(VIS.model_view.plot.size_range);f=d3.scale.linear().domain([0,d3.max(x,function(t){return t.total})]).range([0,VIS.model_view.plot.stroke_range]);w=e.selectAll("g").data(x,function(t){return t.t});m=w.enter().append("g");w.exit().remove();m.append("clipPath").attr("id",function(t){return"clip_circ"+t.t}).append("circle").attr({cx:0,cy:0});m.append("circle").attr("cx",0).attr("cy",0).attr("class",function(t){if(t.t==I){return"topic_select"}else{return"topic_corr"}}).attr("fill",function(t){var e;e=p(t.polarity);if(t.t==I){return"rgba(51,153,255,"+e+")"}else{return"rgba(244,67,57,"+e+")"}}).attr("stroke-width",function(t){return f(t.total)});_=w.selectAll("text.topic_word").data(function(t){var e=[{size:Math.floor(u(v[t.t]/d3.max(v))),t:t.t,text:t.label,y:0}];return e});_.enter().append("text").classed("topic_word",true).attr("clip-path",function(t){return"url(#"+"clip_circ"+t.t}).style("font-size","1px");_.text(function(t){return t.text}).attr("x",0).attr("y",function(t){return t.y});m.selectAll("text.topic_name").data(function(t){var e=t.label.split(" ");return e.map(function(t,i){return{w:t,y:VIS.model_view.plot.name_size*(i-(e.length-1)/2)}})}).enter().append("text").classed("topic_name",true).attr("x",0).attr("y",function(t){return t.y}).text(function(t){return t.w}).style("font-size",VIS.model_view.plot.name_size+"px").classed("merged_topic_sep",function(t){return t.w==="or"});y=function(t){var e="translate("+s(t.x);e+=","+l(t.y)+")";return e};w.transition().duration(1e3).attr("transform",y).selectAll("circle").attr("class",function(t){if(t.t==I){return"topic_select"}else{return"topic_corr"}}).attr("fill",function(t){var e;e=p(t.polarity);if(t.t==I){return"rgba(51,153,255,"+e+")"}else{return"rgba(244,67,57,"+e+")"}}).attr("r",function(t){return 1e3*d3.format(".5f")(v[t.t]/g)});m.transition().duration(0).attr("transform",y).selectAll("circle").attr("class",function(t){if(t.t==I){return"topic_select"}else{return"topic_corr"}}).attr("fill",function(t){var e;e=p(t.polarity);if(t.t==I){return"rgba(51,153,255,"+e+")"}else{return"rgba(244,67,57,"+e+")"}}).attr("r",function(t){return 1e3*d3.format(".5f")(v[t.t]/g)});_.transition().duration(1e3).style("font-size",function(t){return t.size+"px"});m.selectAll("text.topic_word").transition().duration(0).style("font-size",function(t){return t.size+"px"});_.exit().transition().duration(1e3).style("font-size","1px").remove();b=d3.behavior.zoom().x(s).y(l).scaleExtent([1,10]).on("zoom",function(){if(VIS.zoom_transition){w.transition().duration(1e3).attr("transform",y);VIS.zoom_transition=false}else{w.attr("transform",y)}});d3.select("button#reset_zoom_topic").on("click",function(){VIS.zoom_transition=true;b.translate([0,0]).scale(1).event(e)});b(e)};view.topic.words=function(t,e){console.log(t);console.log(e);var i;if(view.updating()&&!view.dirty("topic/words")){return}i=d3.select("table#topic_words tbody").selectAll("tr").data(t);i.enter().append("tr");i.exit().remove();i.on("click",function(t){view.dfb().set_view("/word/"+t.word)});i.selectAll("td").remove();i.append("td").append("a").attr("href",function(t){return"#/word/"+t.word}).text(function(t){return t.word});view.append_weight_tds(i,function(e){return e.weight/t[0].weight});view.dirty("topic/words",false);d3.select("button#words_polarity").on("click",function(){console.log("holi");view.topic.words_pol(t,e)}).text("Polarity");d3.select("#top_word_table").text("Weight")};view.topic.words_pol=function(t,e){console.log("words_pol");console.log(e);var i=e;var n;i.sort(function(t,e){return d3.descending(t.polarity,e.polarity)});console.log("lis");console.log(i);if(view.updating()&&!view.dirty("topic/words")){return}n=d3.select("table#topic_words tbody").selectAll("tr").data(i);n.enter().append("tr");n.exit().remove();n.on("click",function(t){view.dfb().set_view("/word/"+t.word)});n.selectAll("td").remove();n.append("td").append("a").attr("href",function(t){return"#/word/"+t.word}).text(function(t){return t.word});view.append_weight_tds(n,function(t){console.log("w");console.log(t);return t.polarity/i[0].polarity});view.dirty("topic/words",false);d3.select("button#words_polarity").on("click",function(){console.log("holi");view.topic.words(t,i)}).text("Weight");d3.select("#top_word_table").text("Polarity")};view.topic.docs=function(t){var e,i,n=t.docs;if(t.condition!==undefined){e=": ";if(t.type!=="time"){e+=t.condition_name+" "}e+=t.key.display(t.condition);d3.select("#topic_condition_clear").classed("disabled",false).on("click",function(){d3.select(".selected_condition").classed("selected_condition",false);view.updating(true);view.dfb().set_view(view.topic.hash(t.t))}).classed("hidden",false)}else{e="";d3.select("#topic_condition_clear").classed("disabled",true)}d3.selectAll("#topic_docs span.topic_condition").text(e);if(n===undefined||n.length===0){d3.selectAll("#topic_docs .none").classed("hidden",false);d3.select("#topic_docs table").classed("hidden",true);return true}d3.selectAll("#topic_docs .none").classed("hidden",true);d3.select("#topic_docs table").classed("hidden",false);i=d3.select("#topic_docs tbody").selectAll("tr").data(n);i.enter().append("tr");i.exit().remove();i.selectAll("td").remove();i.append("td").append("a").html(function(e,i){return t.citations[i]});i.on("click",function(t){view.dfb().set_view("/doc/"+t.doc)});view.append_weight_tds(i,function(t){return t.frac});i.append("td").classed("td-right",true).text(function(t){return VIS.percent_format(t.frac)});i.append("td").classed("td-right",true).text(function(t){return t.weight});view.dirty("topic/docs",false)};view.topic.conditional=function(t){var e=utils.clone(VIS.topic_view);e.w=d3.select("#topic_conditional").node().clientWidth||e.w;e.w=Math.max(e.w,VIS.topic_view.w);e.w-=e.m.left+e.m.right;e.h=Math.floor(e.w/VIS.topic_view.aspect)-e.m.top-e.m.bottom;e.time.step=VIS.condition.spec;t.svg=view.plot_svg("div#topic_plot",e);t.axes=true;t.clickable=true;t.dirty=view.dirty("topic/conditional");t.spec=e;view.topic.conditional_barplot(t);view.dirty("topic/conditional",false)};view.topic.conditional_barplot=function(t){var e,i,n,o,r,a,d,c,s,l,u,f,p,w,m,_=t.dirty?t.spec.tx_duration:0,v=t.svg,h=t.spec;e=t.data.keys().sort().map(function(e){return{key:e,x:t.key.invert(e),y:t.data.get(e)}});if(t.type==="continuous"){e[0].w=Infinity;i=e.reduce(function(t,e){return{x:e.x,w:Math.min(e.x-t.x,t.w)}}).w;delete e[0].w;d=d3.scale.linear().domain([e[0].x,e[e.length-1].x+i*h.continuous.bar.w]).range([0,h.w]);n=d(e[0].x+i*h.continuous.bar.w)-d(e[0].x);r=-n/2;o=d(e[0].x+i)-d(e[0].x);a=-o/2;w=o/2}else if(t.type==="time"){d=d3.time.scale.utc().domain([e[0].x,d3.time[h.time.bar.unit].utc.offset(e[e.length-1].x,h.time.bar.w)]).range([0,h.w]);n=d(d3.time[h.time.bar.unit].utc.offset(e[0].x,h.time.bar.w))-d(e[0].x);r=-n/2;o=d(d3.time[h.time.step.unit].utc.offset(e[0].x,h.time.step.n))-d(e[0].x);a=-o/2;w=o/2}else{d=d3.scale.ordinal().domain(e.map(function(t){return t.x})).rangeRoundBands([0,h.w],h.ordinal.bar.w,h.ordinal.bar.w);n=d.rangeBand();r=0;o=d(e[1].x)-d(e[0].x);a=(n-o)/2;w=3}c=d3.scale.linear().domain([0,d3.max(e,function(t){return t.y})]).range([h.h,0]).nice();if(t.axes){f=v.selectAll("g.axis").data(["x","y"]);f.enter().append("g").classed("axis",true).classed("x",function(t){return t==="x"}).classed("y",function(t){return t==="y"}).attr("transform",function(t){return t==="x"?"translate(0,"+h.h+")":"translate(-5, 0)"});f.transition().duration(_).attr("transform",function(t){return t==="x"?"translate(0,"+h.h+")":undefined}).each(function(e){var i=d3.select(this),n=d3.svg.axis().scale(e==="x"?d:c).orient(e==="x"?"bottom":"left");if(e==="x"){if(t.type==="time"){if(h.time.ticks.unit){n.ticks(d3.time[h.time.ticks.unit].utc,h.time.ticks.n)}else if(typeof h.time.ticks==="number"){n.ticks(h.time.ticks)}}else{n.ticks(h[t.type].ticks)}}else{n.tickSize(-h.w).outerTickSize(0).tickFormat(VIS.percent_format).tickPadding(w).ticks(h.ticks_y)}i.call(n);if(e==="y"){i.selectAll("g").filter(function(t){return t>0}).classed("minor",true)}});p=v.selectAll("text.axis_label").data([1]);p.enter().append("text");p.classed("axis_label",true).attr("x",h.w/2).attr("y",h.h+h.m.bottom).attr("text-anchor","middle").text(t.condition_name)}s=v.selectAll("g.topic_proportion").data(e,function(t){return t.key});l=s.enter().append("g").classed("topic_proportion",true).attr("transform",function(t){return"translate("+d(t.x)+",0)"});s.exit().remove();if(t.clickable){l.append("rect").classed("interact",true);u=s.select("rect.interact");u.transition().duration(_).attr("x",a).attr("y",0).attr("width",o).attr("height",h.h)}s.classed("selected_condition",function(e){return e.key===t.condition});l.append("rect").classed("display",true).style("fill",t.color).style("stroke",t.color);s.transition().duration(_).attr("transform",function(t){return"translate("+d(t.x)+",0)"}).select("rect.display").attr("x",r).attr("y",function(t){return c(t.y)}).attr("width",n).attr("height",function(t){return h.h-c(t.y)});if(t.clickable){s.on("mouseover",function(t){d3.select(this).classed("hover",true)}).on("mouseout",function(t){d3.select(this).classed("hover",false)});m=function(e){return t.key.display(e.key)};u.on("mouseover",function(t){var e=d3.select(this.parentNode);e.select(".display").classed("hover",true);view.tooltip().text(m(t));view.tooltip().update_pos();view.tooltip().show()}).on("mousemove",function(t){view.tooltip().update_pos()}).on("mouseout",function(t){d3.select(this.parentNode).select(".display").classed("hover",false);view.tooltip().hide()}).on("click",function(e){if(d3.select(this.parentNode).classed("selected_condition")){d3.select(this.parentNode).classed("selected_condition",false);view.tooltip().text(m(e));view.updating(true);view.dfb().set_view(view.topic.hash(t.t))}else{d3.selectAll(".selected_condition").classed("selected_condition",false);d3.select(this.parentNode).classed("selected_condition",true);view.tooltip().text(m(e));view.updating(true);view.dfb().set_view(view.topic.hash(t.t)+"/"+e.key)}})}};view.topic.sort_name=function(t){var e=t.match(/^Topic\s(\d+)$/);if(e){return"zzz"+d3.format("05d")(+e[1])}return t.replace(/^(the|a|an) /i,"").toLowerCase()};view.topic.dropdown=function(t){var e;d3.select("ul#topic_dropdown").selectAll("li.loading_message").remove();e=d3.select("ul#topic_dropdown").selectAll("li").data(t,function(t){return t.topic});e.enter().append("li").append("a").text(function(t){var e=t.words.slice(0,VIS.overview_words).map(function(t){return t.word}).join(" ");return t.label+": "+e}).attr("href",function(t){return view.topic.link(t.topic)});e.sort(function(t,e){return d3.ascending(view.topic.sort_name(t.label),view.topic.sort_name(e.label))});e.classed("hidden_topic",function(t){return t.hidden})};view.topic.link=function(t){return"#"+view.topic.hash(t)};view.topic.hash=function(t){return"/topic/"+String(t+1)};"use strict";view.word=function(t){var e=d3.select("div#word_view"),i=t.word,n=t.n,o,r,a,d,c,s,l,u,f,p,w,m,_,v,h;d3.select("form#word_view_form").on("submit",function(){d3.event.preventDefault();var t=d3.select("input#word_input").property("value").toLowerCase();view.dfb().set_view("/word/"+t)});if(t.word===undefined){return}e.selectAll("#word_view span.word").text(i);e.selectAll("#word_view .none").classed("hidden",t.topics.length!==0);e.select("table#word_topics").classed("hidden",t.topics.length===0);e.select("#word_view_explainer").classed("hidden",t.topics.length===0);o=t.topics.map(function(e,i){var n,o=t.words[i];return o.map(function(t,e){if(e===0){n=t.weight}return{word:t.word,weight:t.weight/n}})});r={m:VIS.word_view.m};r.w=d3.select("#main_container").node().clientWidth||VIS.word_view.w;r.w-=r.m.left+r.m.right;r.h=VIS.word_view.row_height*(t.topics.length+1);a=VIS.word_view.row_height;c=view.plot_svg("#word_view_main",r);d=Math.max(r.w,VIS.word_view.w);l=d3.scale.linear().domain([0,n]).range([0,d]);u=d3.scale.linear().domain([0,Math.max(1,t.topics.length-1)]).range([a,a*(Math.max(t.topics.length,1)+1)]);f=d3.scale.linear().domain([0,1]).range([0,a/2]);s=d3.select("#word_view_clip");if(s.size()===0){s=d3.select("#word_view svg").append("clipPath").attr("id","word_view_clip");s.append("rect")}s.select("rect").attr("x",-r.m.left).attr("y",-r.m.top).attr("width",r.w+r.m.left+r.m.right).attr("height",r.h+r.m.top+r.m.bottom);c.attr("clip-path","url(#word_view_clip)");p=c.selectAll("g.topic").data(t.topics,function(t){return t.topic});p.transition().duration(1e3).attr("transform",function(t,e){return"translate(0,"+u(e)+")"});w=p.enter().append("g").classed("topic",true).attr("transform",function(t,e){return"translate(0,"+u(e)+")"}).style("opacity",0);if(!VIS.ready.word||view.updating()){d3.selectAll("g.topic").style("opacity",1)}else{d3.transition().duration(1e3).ease("linear").each("end",function(){d3.selectAll("g.topic").style("opacity",1)})}p.exit().transition().duration(2e3).attr("transform","translate(0,"+a*(n+p.exit().size())+")").remove();w.append("rect").classed("interact",true).attr({x:-r.m.left,y:-a,width:r.m.left,height:a}).on("click",function(t){view.dfb().set_view(view.topic.hash(t.topic))});m=p.selectAll("text.topic").data(function(e,i){var n=t.labels[i].split(" ");return n.map(function(t,e){return{word:t,y:-a/2-(n.length/2-e-1)*VIS.word_view.topic_label_leading}})},function(t,e){return t.word+String(e)});m.enter().append("text").classed("topic",true);m.exit().remove();m.attr("x",-VIS.word_view.topic_label_padding).attr("y",function(t){return t.y}).text(function(t){return t.word}).classed("merged_topic_sep",function(t){return t.word==="or"});_=p.selectAll("g.word").data(function(t,e){return o[e]},function(t){return t.word});v=_.enter().append("g").classed("word",true);v.append("text").attr("transform","rotate(-45)");v.append("rect").classed("proportion",true).attr({x:0,y:0}).attr("width",d/(2*n)).attr("height",function(t){return f(t.weight)});_.selectAll("text").text(function(t){return t.word});_.selectAll("text, rect").on("click",function(t){view.dfb().set_view("/word/"+t.word)}).on("mouseover",function(){d3.select(this.parentNode).classed("hover",true)}).on("mouseout",function(){d3.select(this.parentNode).classed("hover",false)});_.classed("selected_word",function(t){return t.word===i});v.attr("transform",function(t,e){return"translate("+l(e)+",-"+a/2+")"}).attr("opacity",VIS.ready.word&&!view.updating()?0:1);h=_.transition().duration(2e3).attr("transform",function(t,e){return"translate("+l(e)+",-"+a/2+")"}).attr("opacity",1);h.selectAll("text").attr("x",d/(4*n));h.selectAll("rect").attr("width",d/(2*n)).attr("height",function(t){return f(t.weight)});_.exit().transition().delay(1e3).remove();VIS.ready.word=true;return true};"use strict";view.words=function(t){var e=d3.select("ul#vocab_list").selectAll("li").data(t);e.exit().remove();e.enter().append("li").append("a");e.select("a").text(function(t){return t}).attr("href",function(t){return"#/word/"+t});return true};"use strict";var dfb=function(t){var e=t||{},i={},n,o,r,a,d,c,s,l,u,f,p;e.m=model();if(view.dfb()===undefined){view.dfb(i)}else{view.error("view.dfb already defined: dfb() called more than once?")}e.views=d3.map();e.views.set("topic",function(t,i){var n,o,a=+t-1,d,c,s;if(!e.m.meta()||!e.m.has_dt()||!e.m.tw()){view.loading(true);return true}if(!isFinite(a)||a<0||a>=e.m.n()){d3.select("#topic_view_help").classed("hidden",false);d3.select("#topic_view_main").classed("hidden",true);view.loading(false);return true}n=utils.shorten(e.m.topic_words(a),VIS.topic_view.words);c=utils.shorten(e.m.pl(a),VIS.topic_view.words);console.log(c);view.topic({t:a,words:n,label:e.m.topic_label(a)});d3.select("#topic_view_help").classed("hidden",true);d3.select("#topic_view_main").classed("hidden",false);e.m.total_tokens(function(t){e.m.topic_total(a,function(i){view.topic.remark({alpha:e.m.alpha(a),col_sum:i,total_tokens:t})})});d3.selectAll(".model_view_scaled").classed("hidden",false);d3.selectAll(".model_view_conditional").classed("hidden",false);d3.select("#topic_correlations").classed("hidden",false);r(a);d3.select("#topic_plot_corr").classed("hidden",false);view.topic.words(n,e.m.pl(a));if(VIS.cur_view&&VIS.cur_view.attr("id")==="topic_view"){view.dirty("topic/conditional",true)}if(!view.updating()&&!view.dirty("topic/conditional")){d3.select("#topic_plot").classed("invisible",true)}e.m.topic_conditional(a,e.condition,function(t){view.topic.conditional({t:a,condition:t.has(i)?i:undefined,type:VIS.condition.type,condition_name:e.condition_name,data:t,key:e.m.meta_condition(e.condition)});d3.select("#topic_plot").classed("invisible",false)});view.calculating("#topic_docs",true);d=function(t){view.calculating("#topic_docs",false);view.topic.docs({t:a,docs:t,citations:t.map(function(t){return e.bib.citation(e.m.meta(t.doc))}),condition:i,type:VIS.condition.type,condition_name:e.condition_name,key:e.m.meta_condition(e.condition)})};if(i===undefined){e.m.topic_docs(a,VIS.topic_view.docs,d)}else{e.m.topic_docs_conditional(a,e.condition,i,VIS.topic_view.docs,d)}view.loading(false);return true});e.views.set("word",function(t){var i=d3.select("div#word_view"),n=t,o,r=0;if(!e.m.tw()){view.loading(true);return true}view.loading(false);if(n){i.select("#word_view_help").classed("hidden",true)}else{i.select("#word_view_help").classed("hidden",false);if(VIS.last.word){n=VIS.last.word;i.select("a#last_word").attr("href","#/word/"+n).text(document.URL.replace(/#.*$/,"")+"#/word/"+n);i.select("#last_word_help").classed("hidden",false)}else{i.select("#word_view_main").classed("hidden",true);view.word({word:undefined});return true}}i.select("#word_view_main").classed("hidden",false);VIS.last.word=n;o=e.m.word_topics(n).filter(function(t){return!VIS.topic_hidden[t.topic]||VIS.show_hidden_topics});if(o.length>0){r=1+d3.max(o,function(t){return t.rank});r=d3.max(o,function(t){return e.m.topic_words(t.topic,r).length})}r=Math.max(VIS.word_view.n_min,r);view.word({word:n,topics:o,words:o.map(function(t){return e.m.topic_words(t.topic,r).slice(0,r)}),n:r,n_topics:e.m.n(),labels:o.map(function(t){return e.m.topic_label(t.topic)})});return true});e.views.set("words",function(){var t;if(!e.m.tw()){view.loading(true);return true}view.loading(false);if(!VIS.show_hidden_topics){t=d3.range(e.m.n()).filter(function(t){return!VIS.topic_hidden[t]})}return view.words(e.m.vocab(t))});e.views.set("doc",function(t){var i=d3.select("div#doc_view"),n=+t;if(!e.m.meta()||!e.m.has_dt()||!e.m.tw()){view.loading(true);return true}view.loading(false);if(!isFinite(n)||n<0||n>=e.m.n_docs()){d3.select("#doc_view_help").classed("hidden",false);if(VIS.last.doc===undefined){d3.select("#doc_view_main").classed("hidden",true);return true}n=VIS.last.doc;i.select("a#last_doc").attr("href","#/doc/"+n).text(document.URL.replace(/#.*$/,"")+"#/doc/"+n);i.select("#last_doc_help").classed("hidden",false)}else{d3.select("#doc_view_help").classed("hidden",true);VIS.last.doc=n}d3.select("#doc_view_main").classed("hidden",false);view.calculating("#doc_view",true);e.m.doc_topics(n,e.m.n(),function(t){var i=t.filter(function(t){return!VIS.topic_hidden[t.topic]||VIS.show_hidden_topics});view.calculating("#doc_view",false);view.doc({topics:i,citation:e.bib.citation(e.m.meta(n)),url:e.bib.url(e.m.meta(n)),total_tokens:d3.sum(i,function(t){return t.weight}),words:i.map(function(t){return e.m.topic_words(t.topic,VIS.overview_words)}),labels:i.map(function(t){return e.m.topic_label(t.topic)})});l()});return true});e.views.set("bib",function(t,i,n){var o={major:t,minor:i,dir:n},r;if(!e.m.meta()){view.loading(true);return true}o=e.bib.sort.validate(o);if(o.minor===undefined){if(o.major===undefined){o.minor=VIS.last.bib.minor||VIS.bib_view.minor}else{o.minor=VIS.bib_view.minor}}if(o.major===undefined){o.major=VIS.last.bib.major||VIS.bib_view.major}if(o.dir===undefined){o.dir=VIS.last.bib.dir||VIS.bib_view.dir}VIS.last.bib=o;o.docs=e.m.meta();r=e.bib.sort({major:o.major,minor:o.minor,dir:e.bib.sort.dir(o),docs:e.m.meta()});if(!VIS.ready.bib){VIS.bib_citations=e.m.meta().map(e.bib.citation);view.bib.dropdown(e.bib.sorting());VIS.ready.bib=true}view.bib({ordering:r,major:o.major,minor:o.minor,dir:o.dir,citations:VIS.bib_citations});view.loading(false);VIS.ready.bib=true;return true});e.views.set("about",function(){view.about(e.m.info());view.loading(false);d3.select("#about_view").classed("hidden",false);return true});n=function(){var t={max_words:e.m.n_top_words(),max_docs:e.m.n_docs()};if(t.max_words===undefined||t.max_docs===undefined){return false}view.settings(t);$("#settings_modal").modal();return true};i.settings_modal=n;e.views.set("model",function(t,i,n){var r=t||VIS.last.model||"grid";if(!e.m.tw()||!e.m.topic_scaled()){view.loading(true);return true}d3.selectAll("#nav_model li.active").classed("active",false);d3.select("#nav_model_"+r).classed("active",true);d3.select("#model_view_plot").classed("hidden",true);d3.select("#model_view_list").classed("hidden",true);d3.select("#model_view_conditional").classed("hidden",true);d3.selectAll(".model_view_grid").classed("hidden",true);d3.selectAll(".model_view_scaled").classed("hidden",true);d3.selectAll(".model_view_list").classed("hidden",true);d3.selectAll(".model_view_conditional").classed("hidden",true);d3.select("#model_view nav").classed("hidden",false);if(r==="list"){if(!e.m.meta()||!e.m.has_dt()){view.loading(true);return true}o(i,n);d3.select("#model_view_list").classed("hidden",false)}else if(r==="conditional"){if(!e.m.meta()||!e.m.has_dt()){view.loading(true);return true}d(i);d3.select("#model_view_conditional").classed("hidden",false)}else{if(!e.m.topic_scaled()||!e.m.has_dt()){view.loading(true);return true}if(r!=="scaled"||e.m.topic_scaled().length!==e.m.n()){r="grid"}a(r);d3.select("#model_view_plot").classed("hidden",false)}VIS.last.model=r;d3.selectAll(".model_view_"+r).classed("hidden",false);view.loading(false);return true});o=function(t,i){view.calculating("#model_view_list",true);e.m.topic_total(undefined,function(n){e.m.topic_conditional(undefined,e.condition,function(o){view.calculating("#model_view_list",false);view.model.list({data:o,condition_name:e.condition_name,type:VIS.condition.type,key:e.m.meta_condition(e.condition),sums:n,words:e.m.topic_words(undefined,VIS.overview_words),sort:t,dir:i,labels:d3.range(e.m.n()).map(e.m.topic_label),topic_hidden:VIS.topic_hidden});l()})});return true};r=function(t){e.m.topic_total(undefined,function(i){var n=d3.range(e.m.n()),o,r;if(!VIS.show_hidden_topics){n=n.filter(function(t){return!VIS.topic_hidden[t]})}o=function(o){var r,a;r=o.map(function(t){a=0;t.map(function(t){a+=e.m.dpl(t.doc)*t.weight});return a});view.topic.corr({type:"scaled",select:t,topics:n.map(function(t){return{t:t,words:e.m.topic_words(t,VIS.model_view.plot.words),scaled:e.m.topic_scaled(t),total:i[t],label:e.m.topic_label(t),polarity:r[t],polarity_words:e.m.pl()[t]}})})};return e.m.docs_polarity(n,VIS.topic_view.docs,o)});return true};a=function(t){e.m.topic_total(undefined,function(i){var n=d3.range(e.m.n());if(!VIS.show_hidden_topics){n=n.filter(function(t){return!VIS.topic_hidden[t]})}view.model.plot({type:t,topics:n.map(function(t){return{t:t,words:e.m.topic_words(t,VIS.model_view.plot.words),scaled:e.m.topic_scaled(t),total:i[t],label:e.m.topic_label(t)}})})});return true};d=function(t){var i={type:t,key:e.m.meta_condition(e.condition),condition_type:VIS.condition.type,condition_name:e.condition_name,streamgraph:VIS.model_view.conditional.streamgraph};if(VIS.ready.model_conditional){view.model.conditional(i);return true}view.dirty("model/conditional",true);view.calculating("#model_view_conditional",true);e.m.conditional_total(e.condition,undefined,function(t){e.m.topic_conditional(undefined,e.condition,function(n){i.conditional_totals=t;i.topics=n.map(function(t,i){return{t:i,wts:t,words:e.m.topic_words(i,VIS.model_view.conditional.words),label:e.m.topic_label(i)}}).filter(function(t){return VIS.show_hidden_topics||!VIS.topic_hidden[t.t]});view.model.conditional(i);view.calculating("#model_view_conditional",false)})});return true};c=function(){var t=window.location.hash,n,o,r,a=false,d;if(e.aliases){e.aliases.forEach(function(e,i){t=t.split(e).join(i)})}n=t.split("/");if(VIS.cur_view!==undefined&&!view.updating()){VIS.cur_view.classed("hidden",true)}if(n[0]!=="#"){n=e.default_view}o=n[1];r=n.slice(2,n.length);if(e.views.has(o)){a=e.views.get(o).apply(i,r)}if(a){if(typeof a==="string"){r=[undefined].concat(a.split("/"))}VIS.cur_view=d3.select("div#"+o+"_view");VIS.annotes.forEach(function(t){d3.selectAll(t).classed("hidden",true)});VIS.annotes=[".view_"+o];for(d=1;d<r.length;d+=1){VIS.annotes[d]=VIS.annotes[d-1]+"_"+r[d]}VIS.annotes.forEach(function(t){d3.selectAll(t).classed("hidden",false)})}else{if(VIS.cur_view===undefined){VIS.cur_view=d3.select("div#"+e.default_view[1]+"_view");e.views.get("default")()}}if(!view.updating()){view.scroll_top()}view.updating(false);l();VIS.cur_view.classed("hidden",false);d3.selectAll("#nav_main > li.active").classed("active",false);d3.select("li#nav_"+o).classed("active",true);d3.selectAll("#nav_main li:not(.active) > .nav").classed("hidden",true);d3.selectAll("#nav_main li.active > .nav").classed("hidden",false)};i.refresh=c;s=function(t){window.location.hash=t};i.set_view=s;l=function(t){var e=t===undefined?!VIS.show_hidden_topics:t;d3.selectAll(".hidden_topic").classed("hidden",function(){return e})};i.hide_topics=l;u=function(){window.onhashchange=function(){c()};$(window).resize(function(){if(VIS.resize_timer){window.clearTimeout(VIS.resize_timer)}VIS.resize_timer=window.setTimeout(function(){view.updating(true);view.dirty("topic/conditional",true);c();VIS.resize_timer=undefined},VIS.resize_refresh_delay)});d3.select("#nav_settings a").on("click",function(){d3.event.preventDefault();n()});$("#settings_modal").on("hide.bs.modal",function(){view.updating(true);c()})};i.setup_listeners=u;f=function(t,e){var i,n;if(t===undefined){return e("target undefined",undefined)}i=t.replace(/^.*\//,"");n=d3.select("#m__DATA__"+i.replace(/\..*$/,""));if(!n.empty()){return e(undefined,JSON.parse(n.html()))}if(t.search(/\.zip$/)>0){return d3.xhr(t).responseType("arraybuffer").get(function(t,n){var o,r;if(n&&n.status===200&&n.response.byteLength){o=new JSZip(n.response);r=o.file(i.replace(/\.zip$/,"")).asText()}return e(t,r)})}return d3.text(t,function(t,i){return e(t,i)})};i.load_data=f;p=function(){f(VIS.files.info,function(t,i){if(typeof i==="string"){e.m.info(JSON.parse(i));VIS.update(e.m.info().VIS);d3.selectAll(".model_title").html(e.m.info().title);e.default_view=VIS.default_view.split("/");if(!e.views.has(e.default_view[1])){view.warning("Invalid VIS.default_view setting.");e.default_view=["","model"]}e.views.set("default",e.views.get(e.default_view[1]));e.aliases=d3.map(VIS.aliases)}else{view.warning("Unable to load model info from "+VIS.files.info)}if(e.metadata===undefined){if(VIS.metadata.type==="base"){e.metadata=metadata(VIS.metadata.spec)}else if(VIS.metadata.type==="dfr"){e.metadata=metadata.dfr(VIS.metadata.spec)}else{e.metadata=metadata.dfr();view.warning("Unknown metadata.type; defaulting to dfr.")}}if(e.bib===undefined){e.bib=bib.dfr(VIS.bib)}u();f(VIS.files.meta,function(t,i){if(typeof i==="string"){e.metadata.from_string(i);e.condition=VIS.condition.spec.field;e.condition_name=VIS.condition.name||e.condition;e.metadata.condition(e.condition,metadata.key[VIS.condition.type],VIS.condition.spec);e.m.set_meta(e.metadata);c()}else{view.error("Unable to load metadata from "+VIS.files.meta)}});f(VIS.files.dt,function(t,i){e.m.set_dt(i,function(t){if(t){c()}else{view.error("Unable to load document topics from "+VIS.files.dt)}})});f(VIS.files.tw,function(t,i){if(typeof i==="string"){e.m.set_tw(i);VIS.topic_hidden=d3.range(e.m.n()).map(function(t){return VIS.hidden_topics.indexOf(t+1)!==-1});view.topic.dropdown(d3.range(e.m.n()).map(function(t){return{topic:t,words:e.m.topic_words(t,VIS.model_view.words),label:e.m.topic_label(t),hidden:VIS.topic_hidden[t]}}));c()}else{view.error("Unable to load topic words from "+VIS.files.tw)}});f(VIS.files.pl,function(t,i){if(typeof i==="string"){e.m.set_pl(i);c()}else{view.error("Unable to load topic words from "+VIS.files.pl)}});f(VIS.files.dpl,function(t,i){if(typeof i==="string"){e.m.set_dpl(i);c()}else{view.error("Unable to load topic words from "+VIS.files.dpl)}});f(VIS.files.topic_scaled,function(t,i){if(typeof i==="string"){e.m.set_topic_scaled(i)}else{e.m.set_topic_scaled("");d3.select("#nav_model_scaled").classed("disabled",true).select("a").attr("href","#/model/scaled")}c()});c()})};i.load=p;return i};